{"ast":null,"code":"import { resolveComponent as _resolveComponent, normalizeProps as _normalizeProps, guardReactiveProps as _guardReactiveProps, createVNode as _createVNode, mergeProps as _mergeProps, createElementVNode as _createElementVNode, openBlock as _openBlock, createElementBlock as _createElementBlock, createCommentVNode as _createCommentVNode, renderList as _renderList, Fragment as _Fragment, toDisplayString as _toDisplayString, pushScopeId as _pushScopeId, popScopeId as _popScopeId } from \"vue\";\n\nconst _withScopeId = n => (_pushScopeId(\"data-v-375f2df0\"), n = n(), _popScopeId(), n);\n\nconst _hoisted_1 = {\n  class: \"tw-relative\"\n};\nconst _hoisted_2 = [\"id\", \"value\"];\nconst _hoisted_3 = {\n  key: 0,\n  class: \"tw-absolute tw-w-full tw-z-10 tw-border-b tw-border-x tw-border-gray-300 tw-rounded-b-lg tw-max-h-44 tw-overflow-scroll\"\n};\nconst _hoisted_4 = {\n  key: 0,\n  class: \"tw-p-2 tw-bg-white\"\n};\nconst _hoisted_5 = {\n  key: 1,\n  class: \"tw-p-2 tw-bg-white hover:tw-bg-slate-300 tw-cursor-pointer\"\n};\nconst _hoisted_6 = {\n  key: 0,\n  class: \"tw-bg-white tw-p-2\"\n};\nconst _hoisted_7 = [\"onClick\"];\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  const _component_AppLabel = _resolveComponent(\"AppLabel\");\n\n  const _component_AppErrorMessage = _resolveComponent(\"AppErrorMessage\");\n\n  return _openBlock(), _createElementBlock(\"div\", _hoisted_1, [_createVNode(_component_AppLabel, _normalizeProps(_guardReactiveProps({\n    label: _ctx.label,\n    for: _ctx.name\n  })), null, 16), _createElementVNode(\"input\", _mergeProps(_ctx.$attrs, {\n    autocomplete: \"off\",\n    class: \"app-input\",\n    id: _ctx.name,\n    type: \"text\",\n    onFocus: _cache[0] || (_cache[0] = $event => $setup.showing = true),\n    onBlur: _cache[1] || (_cache[1] = $event => $setup.showing = false),\n    value: $setup.value,\n    onInput: _cache[2] || (_cache[2] = (...args) => $setup.onInput && $setup.onInput(...args))\n  }), null, 16, _hoisted_2), _createVNode(_component_AppErrorMessage, _normalizeProps(_guardReactiveProps({\n    name: _ctx.name\n  })), null, 16), $setup.showing ? (_openBlock(), _createElementBlock(\"div\", _hoisted_3, [$setup.value === '' ? (_openBlock(), _createElementBlock(\"div\", _hoisted_4, \" Начните вводить текст \")) : $setup.loading ? (_openBlock(), _createElementBlock(\"div\", _hoisted_5, \" loading... \")) : (_openBlock(), _createElementBlock(_Fragment, {\n    key: 2\n  }, [$setup.opts.length <= 0 ? (_openBlock(), _createElementBlock(\"div\", _hoisted_6, \" Ничего не найдено \")) : _createCommentVNode(\"\", true), (_openBlock(true), _createElementBlock(_Fragment, null, _renderList($setup.opts, (opt, i) => {\n    return _openBlock(), _createElementBlock(\"div\", {\n      key: i,\n      onClick: $event => $setup.onClick(opt),\n      class: \"tw-p-2 tw-bg-white hover:tw-bg-slate-300 tw-cursor-pointer\"\n    }, _toDisplayString(opt.label), 9, _hoisted_7);\n  }), 128))], 64))])) : _createCommentVNode(\"\", true)]);\n}","map":{"version":3,"mappings":";;;;;AACOA,OAAK,EAAC;;;;;AAgBPA,OAAK,EAAC;;;;AAYDA,OAAK,EAAC;;;;AAKTA,OAAK,EAAC;;;;AAKDA,OAAK,EAAC;;;;;;;;uBAtCjBC,oBAmDM,KAnDN,cAmDM,CAlDJC,aAA0CC,mBAA1C,EAA0CC;AAAAC,WAAtBC,UAAsB;AAAjBC,SAAOD;AAAU,KAA1C,EAAoC,IAApC,EAAoC,EAApC,CAkDI,EAjDJE,oBAUE,OAVF,cACUF,IASR,OAVF,EACgB;AACdG,gBAAY,EAAC,KADC;AAEdT,SAAK,EAAC,WAFQ;AAGbU,MAAE,EAAEJ,SAHS;AAIdK,QAAI,EAAC,MAJS;AAKbC,WAAK,sCAAEC,iBAAO,IAAT,CALQ;AAMbC,UAAI,sCAAED,iBAAO,KAAT,CANS;AAObE,SAAK,EAAEF,YAPM;AAQbG,WAAK,yCAAEH,yCAAF;AARQ,GADhB,wBAiDI,EAtCJX,aAAqCe,0BAArC,EAAqCb;AAAAc,UAAVZ;AAAU,KAArC,EAA+B,IAA/B,EAA+B,EAA/B,CAsCI,EApCIO,gCADRZ,oBAoCM,KApCN,cAoCM,CAtBkCY,iBAAK,oBAA3CZ,oBAEM,KAFN,cAAoD,yBAApD,KAIaY,gCADbZ,oBAKM,KALN,cAGC,cAHD,oBAMAA,oBAYWkB,SAZX,EAYW;AAAAC;AAAA,GAZX,EAYW,CAX6BP,YAAKQ,MAAL,IAAW,mBAAjDpB,oBAEM,KAFN,cAAwD,qBAAxD,kCAWS,qBARTA,oBAOMkB,SAPN,EAOM,IAPN,EAOMG,YANeT,WAMf,EANmB,CAAfU,GAAe,EAAVC,CAAU,KAAT;yBADhBvB,oBAOM,KAPN,EAOM;AALHmB,SAAG,EAAEI,CAKF;AAJHC,aAAK,YAAEZ,eAAQU,GAAR,CAIJ;AAHJvB,WAAK,EAAC;AAGF,KAPN,mBAMKuB,GAAG,CAAClB,MANT,EAMc,CANd,EAMcqB,UANd;GAOM,CAPN,MAQS,EAZX,MAaI,CApCN,kCAqCI,CAnDN","names":["class","_createElementBlock","_createVNode","_component_AppLabel","_normalizeProps","label","_ctx","for","_createElementVNode","autocomplete","id","type","onFocus","$setup","onBlur","value","onInput","_component_AppErrorMessage","name","_Fragment","key","length","_renderList","opt","i","onClick","_hoisted_7"],"sourceRoot":"","sources":["C:\\projects\\gazprom\\formApplication\\src\\core\\AppFilterSelect.vue"],"sourcesContent":["<template>\n  <div class=\"tw-relative\">\n    <AppLabel v-bind=\"{ label, for: name }\" />\n    <input\n      v-bind=\"$attrs\"\n      autocomplete=\"off\"\n      class=\"app-input\"\n      :id=\"name\"\n      type=\"text\"\n      @focus=\"showing = true\"\n      @blur=\"showing = false\"\n      :value=\"value\"\n      @input=\"onInput\"\n    />\n    <AppErrorMessage v-bind=\"{ name }\" />\n    <div\n      v-if=\"showing\"\n      class=\"\n        tw-absolute\n        tw-w-full\n        tw-z-10\n        tw-border-b\n        tw-border-x\n        tw-border-gray-300\n        tw-rounded-b-lg\n        tw-max-h-44\n        tw-overflow-scroll\n      \"\n    >\n      <div class=\"tw-p-2 tw-bg-white\" v-if=\"value === ''\">\n        Начните вводить текст\n      </div>\n      <div\n        v-else-if=\"loading\"\n        class=\"tw-p-2 tw-bg-white hover:tw-bg-slate-300 tw-cursor-pointer\"\n      >\n        loading...\n      </div>\n      <template v-else>\n        <div class=\"tw-bg-white tw-p-2\" v-if=\"opts.length <= 0\">\n          Ничего не найдено\n        </div>\n        <div\n          v-for=\"(opt, i) in opts\"\n          :key=\"i\"\n          @click=\"onClick(opt)\"\n          class=\"tw-p-2 tw-bg-white hover:tw-bg-slate-300 tw-cursor-pointer\"\n        >\n          {{ opt.label }}\n        </div>\n      </template>\n    </div>\n  </div>\n</template>\n<script>\nimport { Field, useField } from 'vee-validate';\nimport { ref, toRefs, computed } from 'vue';\nimport { throttle } from '@/utilities/perfomance';\n\nexport default {\n  inheritAttrs: false,\n  props: {\n    ...Field.props,\n    fetcher: {\n      required: true,\n      type: Function,\n    },\n    option: {\n      default() {\n        return (option) => option;\n      },\n      type: Function,\n    },\n  },\n  setup(props) {\n    const showing = ref(false);\n    const options = ref([]);\n    const loading = ref(false);\n    const { label, rules, name } = toRefs(props);\n    const { value, handleChange } = useField(name, rules, {\n      validateOnValueUpdate: false,\n      label,\n    });\n\n    const { value: current, handleChange: selectChange } = useField(\n      computed(() => name.value + '-s'),\n      '',\n      // { standalone: true }\n    );\n\n    const opts = computed(() => {\n      return options.value.map((opt) => ({ ...props.option(opt), meta: opt }));\n    });\n\n    const upload = throttle(async () => {\n      if (value.value === '') return;\n\n      try {\n        loading.value = true;\n        const loader = async () => props.fetcher(value.value);\n        options.value = await loader();\n      } catch (err) {\n        console.error(err);\n        alert('Произошла ошибка при загрузке данных!');\n      } finally {\n        loading.value = false;\n      }\n    }, 800);\n\n    return {\n      current,\n      opts,\n      loading,\n      value,\n      handleChange,\n      selectChange,\n      showing,\n      onClick(opt) {\n        handleChange(opt.value);\n        selectChange(opt.meta);\n        showing.value = false;\n      },\n      onInput(e) {\n        loading.value = true;\n        handleChange(e);\n        upload();\n      },\n    };\n  },\n};\n</script>\n\n<style scoped>\n.app-input {\n  @apply tw-border tw-border-gray-400 tw-rounded-lg tw-h-8 tw-px-2 tw-block tw-w-full;\n}\n\n.app-input:hover,\n.app-input:focus {\n  @apply tw-border-primary;\n}\n</style>\n"]},"metadata":{},"sourceType":"module"}