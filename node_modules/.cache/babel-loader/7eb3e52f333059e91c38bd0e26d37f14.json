{"ast":null,"code":"import \"core-js/modules/es.function.name.js\";\nimport { toDisplayString as _toDisplayString, openBlock as _openBlock, createElementBlock as _createElementBlock, createCommentVNode as _createCommentVNode, createTextVNode as _createTextVNode, createElementVNode as _createElementVNode, mergeProps as _mergeProps, renderList as _renderList, Fragment as _Fragment, resolveComponent as _resolveComponent, createBlock as _createBlock, normalizeProps as _normalizeProps, guardReactiveProps as _guardReactiveProps, withCtx as _withCtx, createVNode as _createVNode } from \"vue\";\nvar _hoisted_1 = {\n  class: \"sm:tw-col-span-3\"\n};\nvar _hoisted_2 = {\n  class: \"tw-block tw-text-sm tw-font-medium tw-leading-6 tw-text-gray-500\"\n};\nvar _hoisted_3 = {\n  key: 0,\n  class: \"tw-text-red-600\",\n  title: \"Обязательное поле\"\n};\nvar _hoisted_4 = {\n  name: \"removed_files_id\",\n  type: \"hidden\",\n  ref: \"removedFilesID\"\n};\nvar _hoisted_5 = {\n  class: \"tw-flex tw-items-center tw-justify-center tw-w-full\"\n};\nvar _hoisted_6 = [\"for\"];\n\nvar _hoisted_7 = /*#__PURE__*/_createElementVNode(\"div\", {\n  class: \"tw-flex tw-flex-col tw-items-center tw-justify-center tw-pt-5 tw-pb-6\"\n}, [/*#__PURE__*/_createElementVNode(\"svg\", {\n  \"aria-hidden\": \"true\",\n  class: \"tw-w-10 tw-h-10 tw-mb-3 tw-text-gray-400\",\n  fill: \"none\",\n  stroke: \"currentColor\",\n  viewBox: \"0 0 24 24\",\n  xmlns: \"http://www.w3.org/2000/svg\"\n}, [/*#__PURE__*/_createElementVNode(\"path\", {\n  \"stroke-linecap\": \"round\",\n  \"stroke-linejoin\": \"round\",\n  \"stroke-width\": \"2\",\n  d: \"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12\"\n})]), /*#__PURE__*/_createElementVNode(\"p\", {\n  class: \"tw-mb-2 tw-text-sm tw-text-gray-500 dark:tw-text-gray-400\"\n}, [/*#__PURE__*/_createElementVNode(\"span\", {\n  class: \"tw-font-semibold\"\n}, \"Нажмите чтобы загрузить\"), /*#__PURE__*/_createTextVNode(\" или перетащите файлы сюда\")]), /*#__PURE__*/_createElementVNode(\"p\", {\n  class: \"tw-text-xs tw-text-gray-500 dark:tw-text-gray-400\"\n}, \"JPG, PNG, DOC, DOCX, PDF (максимум 4 файла в сумме не более 20 мб)\")], -1);\n\nvar _hoisted_8 = [\"id\", \"name\", \"onChange\", \"accept\"];\nvar _hoisted_9 = {\n  key: 0,\n  class: \"tw-flex tw-mt-3 tw-items-baseline tw-space-x-4\"\n};\nvar _hoisted_10 = [\"href\"];\nvar _hoisted_11 = {\n  key: 0,\n  class: \"tw-pl-2\"\n};\nvar _hoisted_12 = [\"onClick\"];\n\nvar _hoisted_13 = /*#__PURE__*/_createElementVNode(\"svg\", {\n  xmlns: \"http://www.w3.org/2000/svg\",\n  width: \"16\",\n  height: \"16\",\n  fill: \"currentColor\",\n  class: \"tw-text-red-600\",\n  viewBox: \"0 0 16 16\"\n}, [/*#__PURE__*/_createElementVNode(\"path\", {\n  d: \"M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5Zm2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5Zm3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0V6Z\"\n}), /*#__PURE__*/_createElementVNode(\"path\", {\n  d: \"M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1v1ZM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4H4.118ZM2.5 3h11V2h-11v1Z\"\n})], -1);\n\nvar _hoisted_14 = [_hoisted_13];\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  var _this = this;\n\n  var _component_AppErrorMessage = _resolveComponent(\"AppErrorMessage\");\n\n  var _component_VField = _resolveComponent(\"VField\");\n\n  return _openBlock(), _createElementBlock(\"div\", _hoisted_1, [_createElementVNode(\"span\", _hoisted_2, [_createTextVNode(_toDisplayString(_ctx.label), 1), $setup.hasRequiredRule ? (_openBlock(), _createElementBlock(\"abbr\", _hoisted_3, \" *\")) : _createCommentVNode(\"\", true)]), _createElementVNode(\"input\", _hoisted_4, null, 512), _createVNode(_component_VField, _normalizeProps(_guardReactiveProps({\n    name: _ctx.name,\n    rules: _ctx.rules,\n    label: _ctx.label\n  })), {\n    default: _withCtx(function (_ref) {\n      var handleChange = _ref.handleChange,\n          errorMessage = _ref.errorMessage;\n      return [_createElementVNode(\"div\", _hoisted_5, [_createElementVNode(\"label\", {\n        for: _ctx.name,\n        class: \"tw-flex tw-flex-col tw-items-center tw-justify-center tw-w-full tw-h-38 tw-border-2 tw-border-gray-300 tw-border-dashed tw-rounded-lg tw-cursor-pointer tw-bg-gray-50 dark:hover:tw-bg-bray-800 dark:tw-bg-gray-700 hover:tw-bg-gray-100 dark:tw-border-gray-600 dark:hover:tw-border-gray-500 dark:hover:tw-bg-gray-600\"\n      }, [_hoisted_7, _createElementVNode(\"input\", _mergeProps({\n        ref: \"fileInput\"\n      }, _ctx.$attrs, {\n        id: _ctx.name,\n        type: \"file\",\n        name: _ctx.name,\n        onChange: function onChange($event) {\n          return $options.onChange($event, handleChange);\n        },\n        accept: $props.accept,\n        class: \"tw-hidden\"\n      }), null, 16, _hoisted_8)], 8, _hoisted_6)]), $data.data_files.length != 0 ? (_openBlock(), _createElementBlock(\"div\", _hoisted_9, [(_openBlock(true), _createElementBlock(_Fragment, null, _renderList($data.data_files, function (file, index) {\n        return _openBlock(), _createElementBlock(\"div\", {\n          key: index,\n          href: \"#\",\n          class: \"tw-flex tw-text-sm tw-leading-6 tw-text-gray-600 tw-justify-between\"\n        }, [_createElementVNode(\"a\", {\n          href: _this.data_files_link[index],\n          class: \"tw-text-gazblue\",\n          title: \"Скачать\",\n          target: \"_blank\"\n        }, _toDisplayString(file.name), 9, _hoisted_10), $data.data_original_name[index] ? (_openBlock(), _createElementBlock(\"span\", _hoisted_11, \" [ \" + _toDisplayString($data.data_original_name[index]) + \" ]\", 1)) : _createCommentVNode(\"\", true), _createElementVNode(\"a\", {\n          href: \"javascript:;\",\n          onClick: function onClick($event) {\n            return $options.removeFile(index, handleChange);\n          }\n        }, _hoisted_14, 8, _hoisted_12)]);\n      }), 128))])) : _createCommentVNode(\"\", true), errorMessage ? (_openBlock(), _createBlock(_component_AppErrorMessage, {\n        key: 1,\n        msg: errorMessage\n      }, null, 8, [\"msg\"])) : _createCommentVNode(\"\", true)];\n    }),\n    _: 1\n  }, 16)]);\n}","map":{"version":3,"mappings":"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","names":["class","title","name","type","ref","_createElementVNode","fill","stroke","viewBox","xmlns","d","width","height","_hoisted_13","_createElementBlock","_ctx","$setup","_createVNode","_component_VField","_normalizeProps","rules","label","handleChange","errorMessage","for","_hoisted_7","id","onChange","$options","$event","accept","$props","$data","length","_Fragment","_renderList","file","index","key","href","data_files_link","target","_hoisted_10","_toDisplayString","onClick","_createBlock","_component_AppErrorMessage","msg"],"sourceRoot":"","sources":["C:\\projects\\gazprom\\formApplication\\src\\core\\AppFile.vue"],"sourcesContent":["<template>\n  <div class=\"sm:tw-col-span-3\">\n    <span class=\"tw-block tw-text-sm tw-font-medium tw-leading-6 tw-text-gray-500\">{{ label }}<abbr v-if=\"hasRequiredRule\" class=\"tw-text-red-600\" title=\"Обязательное поле\"> *</abbr></span>\n    <input name=\"removed_files_id\" type=\"hidden\" ref=\"removedFilesID\">\n    <VField v-bind=\"{ name, rules, label }\" v-slot=\"{ handleChange, errorMessage }\">\n      <div class=\"tw-flex tw-items-center tw-justify-center tw-w-full\">\n          <label :for=\"name\" class=\"tw-flex tw-flex-col tw-items-center tw-justify-center tw-w-full tw-h-38 tw-border-2 tw-border-gray-300 tw-border-dashed tw-rounded-lg tw-cursor-pointer tw-bg-gray-50 dark:hover:tw-bg-bray-800 dark:tw-bg-gray-700 hover:tw-bg-gray-100 dark:tw-border-gray-600 dark:hover:tw-border-gray-500 dark:hover:tw-bg-gray-600\">\n              <div class=\"tw-flex tw-flex-col tw-items-center tw-justify-center tw-pt-5 tw-pb-6\">\n                  <svg aria-hidden=\"true\" class=\"tw-w-10 tw-h-10 tw-mb-3 tw-text-gray-400\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\" xmlns=\"http://www.w3.org/2000/svg\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12\"></path></svg>\n                  <p class=\"tw-mb-2 tw-text-sm tw-text-gray-500 dark:tw-text-gray-400\"><span class=\"tw-font-semibold\">Нажмите чтобы загрузить</span> или перетащите файлы сюда</p>\n                  <p class=\"tw-text-xs tw-text-gray-500 dark:tw-text-gray-400\">JPG, PNG, DOC, DOCX, PDF (максимум 4 файла в сумме не более 20 мб)</p>\n              </div>\n              <input ref=\"fileInput\" v-bind=\"$attrs\" :id=\"name\" type=\"file\" :name=\"name\" @change=\"onChange($event, handleChange)\" :accept=\"accept\" class=\"tw-hidden\" />\n          </label>\n      </div>\n      <div v-if=\"data_files.length != 0\" class=\"tw-flex tw-mt-3 tw-items-baseline tw-space-x-4\">\n        <div v-for=\"(file, index) in data_files\" :key=\"index\" href=\"#\" class=\"tw-flex tw-text-sm tw-leading-6 tw-text-gray-600 tw-justify-between\">\n          <a :href=\"this.data_files_link[index]\" class=\"tw-text-gazblue\" title=\"Скачать\" target=\"_blank\">{{ file.name }}</a><span v-if=\"data_original_name[index]\" class=\"tw-pl-2\"> [ {{ data_original_name[index] }} ]</span>\n          <a href=\"javascript:;\" @click=\"removeFile(index, handleChange)\">\n            <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" height=\"16\" fill=\"currentColor\" class=\"tw-text-red-600\" viewBox=\"0 0 16 16\">\n              <path d=\"M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5Zm2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5Zm3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0V6Z\"/>\n              <path d=\"M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1v1ZM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4H4.118ZM2.5 3h11V2h-11v1Z\"/>\n            </svg>\n          </a>\n      </div>\n      </div>\n      <AppErrorMessage v-if=\"errorMessage\" :msg=\"errorMessage\" />\n    </VField>\n\n\n  </div>\n</template>\n<script>\nimport { Field, useFieldValue, useField } from 'vee-validate';\nimport useRules from '@/compositions/useRules';\nimport { toRef, ref } from '@vue/reactivity';\n\nexport default {\n  inheritAttrs: false,\n  props: {\n    ...Field.props,\n    filename: {\n      default: undefined,\n      type: [Array, String]\n    },\n    accept: String,\n  },\n  data() {\n    return {\n      data_files: [],\n      data_files_size: 0,\n      data_original_name: [],\n      data_files_link: [],\n      data_files_bx_id: [],\n      data_removed_files_id: [],\n    }\n  },\n  setup(props) {\n    const fileName = ref([]);\n    const rules = toRef(props, 'rules');\n    const { hasRequiredRule } = useRules(rules);\n\n    const value = useFieldValue(props.name);\n\n    return {\n      hasRequiredRule,\n      fileName,\n      value\n    };\n  },\n  methods: {\n    onChange(e, handleChange) {\n\n      const maxSizeFiles = 20971520;\n      const maxLimitFiles = 4;\n      const files = e.target.files;\n      const validFileTypes = ['image/jpeg', 'image/png', 'application/pdf', 'application/msword', 'application/vnd.openxmlformats-officedocument.wordprocessingml.document'];\n\n      if(!files || files.length <= 0) return;\n \n      if(files.length > maxLimitFiles || this.data_files.length > maxLimitFiles - 1) {\n        alert(\"Для загрузки вложений, допустимо максимально 4 файла\");\n        return;\n      }\n\n      for (var i = 0; i < files.length; i++ ) {\n        if(validFileTypes.includes(files[i]['type'])) {\n\n          if (this.data_files_size + files[i]['size'] > maxSizeFiles) {\n            alert(\"Превышена допустимая сумма размера файлов 20 мегабайт\");\n            return;\n          }\n\n          this.data_files_size += files[i]['size'];\n          this.data_files.push(files[i]);\n\n        } else {\n          alert(\"Неверный тип файла. Допустимые расширения файлов: JPG, PNG, DOC, DOCX, PDF\");\n        }\n      }\n\n      handleChange(this.data_files);\n\n\n    },\n    parseFiles(files) {\n      if(!files) return;\n\n      if(files instanceof File) return this.fileName = [files.name];\n\n      this.fileName = [];\n      for(let file of files) {\n        this.fileName.push(file.name);\n      }\n    },\n    removeFile(index, handleChange) {\n\n      let fileSize = this.data_files[index]['size'];\n      this.data_files_size = this.data_files_size - fileSize\n      this.data_files.splice(index, 1);\n      this.data_files_link.splice(index, 1);\n      this.data_original_name.splice(index, 1);\n      this.data_removed_files_id.push(this.data_files_bx_id[index])\n\n      const dataTransfer = new DataTransfer();\n\n      for (let i = 0; i < this.data_files.length; i++ ) {\n        dataTransfer.items.add(this.data_files[i]);\n      }\n\n\n      this.$refs.removedFilesID.value = this.data_removed_files_id;\n\n      handleChange(dataTransfer.files);\n    }\n  },\n  watch: {\n    value: {\n      async handler(files) {\n\n        if (files) {\n          for (let i = 0; i < files.length; i++ ) {\n            \n            // Если в режиме редактирования подгружаются файлы\n            if (!(files[i] instanceof File)) {\n\n              let blob = await fetch(\"/logo.png\").then((response) => response.blob());\n\n              let fileblob = await blob;\n\n              let file = new File([fileblob], files[i]['name'], {type: files[i]['type']})\n\n              this.data_files_link[i] = files[i]['src'];  // Записываем ссылку до файла\n              this.data_original_name[i] = files[i]['original_name'];  //Записываем оригинальные имена файлов в отдельный массив\n              this.data_files_bx_id[i] = files[i]['id'];  // ID файлов в хайлоадблоке File\n              files[i] = file; //Перезаписываем обычный массив файла в File()\n              this.data_files_size += files[i]['size'];\n              this.data_files.push(file);\n\n            }\n\n          }\n        }\n\n      },\n      immediate: true\n    },\n    filename(val) {\n      if(!val) return;\n      if(Array.isArray(val)) {\n        this.fileName = val;\n      } else {\n        this.fileName = [val];\n      }\n    }\n  },\n};\n</script>\n"]},"metadata":{},"sourceType":"module"}