{"ast":null,"code":"import \"core-js/modules/es.function.name.js\";\nimport { resolveComponent as _resolveComponent, normalizeProps as _normalizeProps, guardReactiveProps as _guardReactiveProps, createVNode as _createVNode, mergeProps as _mergeProps, createElementVNode as _createElementVNode, openBlock as _openBlock, createElementBlock as _createElementBlock, createCommentVNode as _createCommentVNode, renderList as _renderList, Fragment as _Fragment, toDisplayString as _toDisplayString, pushScopeId as _pushScopeId, popScopeId as _popScopeId } from \"vue\";\n\nvar _withScopeId = function _withScopeId(n) {\n  return _pushScopeId(\"data-v-0451919e\"), n = n(), _popScopeId(), n;\n};\n\nvar _hoisted_1 = {\n  class: \"tw-relative\"\n};\nvar _hoisted_2 = [\"id\", \"value\"];\nvar _hoisted_3 = {\n  key: 0,\n  class: \"tw-absolute tw-w-full tw-z-10 tw-border-b tw-border-x tw-border-gray-300 tw-rounded-b-lg tw-max-h-44 tw-overflow-scroll\"\n};\nvar _hoisted_4 = {\n  key: 0,\n  class: \"tw-p-2 tw-bg-white\"\n};\nvar _hoisted_5 = {\n  key: 1,\n  class: \"tw-p-2 tw-bg-white hover:tw-bg-slate-300 tw-cursor-pointer\"\n};\nvar _hoisted_6 = {\n  key: 0,\n  class: \"tw-bg-white tw-p-2\"\n};\nvar _hoisted_7 = [\"onClick\"];\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  var _component_AppLabel = _resolveComponent(\"AppLabel\");\n\n  var _component_AppErrorMessage = _resolveComponent(\"AppErrorMessage\");\n\n  return _openBlock(), _createElementBlock(\"div\", _hoisted_1, [_createVNode(_component_AppLabel, _normalizeProps(_guardReactiveProps({\n    label: _ctx.label,\n    for: _ctx.name\n  })), null, 16\n  /* FULL_PROPS */\n  ), _createElementVNode(\"input\", _mergeProps(_ctx.$attrs, {\n    autocomplete: \"off\",\n    class: \"app-input\",\n    id: _ctx.name,\n    type: \"text\",\n    onFocus: _cache[0] || (_cache[0] = function ($event) {\n      return $setup.showing = true;\n    }),\n    onBlur: _cache[1] || (_cache[1] = function ($event) {\n      return $setup.showing = false;\n    }),\n    value: $setup.value,\n    onInput: _cache[2] || (_cache[2] = function () {\n      return $setup.onInput && $setup.onInput.apply($setup, arguments);\n    })\n  }), null, 16\n  /* FULL_PROPS */\n  , _hoisted_2), _createVNode(_component_AppErrorMessage, _normalizeProps(_guardReactiveProps({\n    name: _ctx.name\n  })), null, 16\n  /* FULL_PROPS */\n  ), $setup.showing ? (_openBlock(), _createElementBlock(\"div\", _hoisted_3, [$setup.value === '' ? (_openBlock(), _createElementBlock(\"div\", _hoisted_4, \" Начните вводить текст \")) : $setup.loading ? (_openBlock(), _createElementBlock(\"div\", _hoisted_5, \" loading... \")) : (_openBlock(), _createElementBlock(_Fragment, {\n    key: 2\n  }, [$setup.opts.length <= 0 ? (_openBlock(), _createElementBlock(\"div\", _hoisted_6, \" Ничего не найдено \")) : _createCommentVNode(\"v-if\", true), (_openBlock(true), _createElementBlock(_Fragment, null, _renderList($setup.opts, function (opt, i) {\n    return _openBlock(), _createElementBlock(\"div\", {\n      key: i,\n      onClick: function onClick($event) {\n        return $setup.onClick(opt);\n      },\n      class: \"tw-p-2 tw-bg-white hover:tw-bg-slate-300 tw-cursor-pointer\"\n    }, _toDisplayString(opt.label), 9\n    /* TEXT, PROPS */\n    , _hoisted_7);\n  }), 128\n  /* KEYED_FRAGMENT */\n  ))], 64\n  /* STABLE_FRAGMENT */\n  ))])) : _createCommentVNode(\"v-if\", true)]);\n}","map":{"version":3,"mappings":";;;;;;;;AACOA,OAAK,EAAC;;;;;AAgBPA,OAAK,EAAC;;;;AAYDA,OAAK,EAAC;;;;AAKTA,OAAK,EAAC;;;;AAKDA,OAAK,EAAC;;;;;;;;uBAtCjBC,oBAmDM,KAnDN,cAmDM,CAlDJC,aAA0CC,mBAA1C,EAA0CC;AAAAC,WAAtBC,UAAsB;AAAjBC,SAAOD;AAAU,KAA1C,EAAoC,IAApC,EAAoC;AAAA;AAApC,GAkDI,EAjDJE,oBAUE,OAVF,cACUF,IASR,OAVF,EACgB;AACdG,gBAAY,EAAC,KADC;AAEdT,SAAK,EAAC,WAFQ;AAGbU,MAAE,EAAEJ,SAHS;AAIdK,QAAI,EAAC,MAJS;AAKbC,WAAK;AAAA,aAAEC,iBAAO,IAAT;AAAA,MALQ;AAMbC,UAAI;AAAA,aAAED,iBAAO,KAAT;AAAA,MANS;AAObE,SAAK,EAAEF,YAPM;AAQbG,WAAK;AAAA,aAAEH,yDAAF;AAAA;AARQ,GADhB;;AAAA,eAiDI,EAtCJX,aAAqCe,0BAArC,EAAqCb;AAAAc,UAAVZ;AAAU,KAArC,EAA+B,IAA/B,EAA+B;AAAA;AAA/B,GAsCI,EApCIO,gCADRZ,oBAoCM,KApCN,cAoCM,CAtBkCY,iBAAK,oBAA3CZ,oBAEM,KAFN,cAAoD,yBAApD,KAIaY,gCADbZ,oBAKM,KALN,cAGC,cAHD,oBAMAA,oBAYWkB,SAZX,EAYW;AAAAC;AAAA,GAZX,EAYW,CAX6BP,YAAKQ,MAAL,IAAW,mBAAjDpB,oBAEM,KAFN,cAAwD,qBAAxD,sCAWS,qBARTA,oBAOMkB,SAPN,EAOM,IAPN,EAOMG,YANeT,WAMf,EANmB,UAAfU,GAAe,EAAVC,CAAU,EAAT;yBADhBvB,oBAOM,KAPN,EAOM;AALHmB,SAAG,EAAEI,CAKF;AAJHC,aAAK;AAAA,eAAEZ,eAAQU,GAAR,CAAF;AAAA,OAIF;AAHJvB,WAAK,EAAC;AAGF,KAPN,mBAMKuB,GAAG,CAAClB,MANT,EAMc;AAAA;AANd,MAMcqB,UANd;GAOM,CAPN;;AAAA,GAQS,EAZX;;AAAA,IAaI,CApCN,sCAqCI,CAnDN","names":["class","_createElementBlock","_createVNode","_component_AppLabel","_normalizeProps","label","_ctx","for","_createElementVNode","autocomplete","id","type","onFocus","$setup","onBlur","value","onInput","_component_AppErrorMessage","name","_Fragment","key","length","_renderList","opt","i","onClick","_hoisted_7"],"sourceRoot":"","sources":["C:\\projects\\gazprom\\formApplication\\src\\core\\AppFilterSelect.vue"],"sourcesContent":["<template>\n  <div class=\"tw-relative\">\n    <AppLabel v-bind=\"{ label, for: name }\" />\n    <input\n      v-bind=\"$attrs\"\n      autocomplete=\"off\"\n      class=\"app-input\"\n      :id=\"name\"\n      type=\"text\"\n      @focus=\"showing = true\"\n      @blur=\"showing = false\"\n      :value=\"value\"\n      @input=\"onInput\"\n    />\n    <AppErrorMessage v-bind=\"{ name }\" />\n    <div\n      v-if=\"showing\"\n      class=\"\n        tw-absolute\n        tw-w-full\n        tw-z-10\n        tw-border-b\n        tw-border-x\n        tw-border-gray-300\n        tw-rounded-b-lg\n        tw-max-h-44\n        tw-overflow-scroll\n      \"\n    >\n      <div class=\"tw-p-2 tw-bg-white\" v-if=\"value === ''\">\n        Начните вводить текст\n      </div>\n      <div\n        v-else-if=\"loading\"\n        class=\"tw-p-2 tw-bg-white hover:tw-bg-slate-300 tw-cursor-pointer\"\n      >\n        loading...\n      </div>\n      <template v-else>\n        <div class=\"tw-bg-white tw-p-2\" v-if=\"opts.length <= 0\">\n          Ничего не найдено\n        </div>\n        <div\n          v-for=\"(opt, i) in opts\"\n          :key=\"i\"\n          @click=\"onClick(opt)\"\n          class=\"tw-p-2 tw-bg-white hover:tw-bg-slate-300 tw-cursor-pointer\"\n        >\n          {{ opt.label }}\n        </div>\n      </template>\n    </div>\n  </div>\n</template>\n<script>\nimport { Field, useField } from 'vee-validate';\nimport { ref, toRefs, computed } from 'vue';\nimport { throttle } from '@/utilities/perfomance';\n\nexport default {\n  inheritAttrs: false,\n  props: {\n    ...Field.props,\n    fetcher: {\n      required: true,\n      type: Function,\n    },\n    option: {\n      default() {\n        return (option) => option;\n      },\n      type: Function,\n    },\n  },\n  setup(props) {\n    const showing = ref(false);\n    const options = ref([]);\n    const loading = ref(false);\n    const { label, rules, name } = toRefs(props);\n    const { value, handleChange } = useField(name, rules, {\n      validateOnValueUpdate: false,\n      label,\n    });\n\n    const { value: current, handleChange: selectChange } = useField(\n      computed(() => name.value + '-s'),\n      '',\n      // { standalone: true }\n    );\n\n    const opts = computed(() => {\n      return options.value.map((opt) => ({ ...props.option(opt), meta: opt }));\n    });\n\n    const upload = throttle(async () => {\n      if (value.value === '') return;\n\n      try {\n        loading.value = true;\n        const loader = async () => props.fetcher(value.value);\n        options.value = await loader();\n      } catch (err) {\n        console.error(err);\n        alert('Произошла ошибка при загрузке данных!');\n      } finally {\n        loading.value = false;\n      }\n    }, 800);\n\n    return {\n      current,\n      opts,\n      loading,\n      value,\n      handleChange,\n      selectChange,\n      showing,\n      onClick(opt) {\n        handleChange(opt.value);\n        selectChange(opt.meta);\n        showing.value = false;\n      },\n      onInput(e) {\n        loading.value = true;\n        handleChange(e);\n        upload();\n      },\n    };\n  },\n};\n</script>\n\n<style scoped>\n.app-input {\n  @apply tw-border tw-border-gray-400 tw-rounded-lg tw-h-8 tw-px-2 tw-block tw-w-full;\n}\n\n.app-input:hover,\n.app-input:focus {\n  @apply tw-border-primary;\n}\n</style>\n"]},"metadata":{},"sourceType":"module"}