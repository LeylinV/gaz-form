{"ast":null,"code":"import _asyncToGenerator from \"C:/projects/gazprom/formApplication/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport _objectSpread from \"C:/projects/gazprom/formApplication/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";\nimport \"regenerator-runtime/runtime.js\";\nimport \"core-js/modules/es.function.name.js\";\nimport \"core-js/modules/es.array.map.js\";\nimport { Field, useField } from 'vee-validate';\nimport { ref, toRefs, computed } from 'vue';\nimport { throttle } from '@/utilities/perfomance';\nexport default {\n  inheritAttrs: false,\n  props: _objectSpread(_objectSpread({}, Field.props), {}, {\n    fetcher: {\n      required: true,\n      type: Function\n    },\n    option: {\n      default: function _default() {\n        return function (option) {\n          return option;\n        };\n      },\n      type: Function\n    }\n  }),\n  setup: function setup(props) {\n    var showing = ref(false);\n    var options = ref([]);\n    var loading = ref(false);\n\n    var _toRefs = toRefs(props),\n        label = _toRefs.label,\n        rules = _toRefs.rules,\n        name = _toRefs.name;\n\n    var _useField = useField(name, rules, {\n      validateOnValueUpdate: false,\n      label: label\n    }),\n        value = _useField.value,\n        handleChange = _useField.handleChange;\n\n    var _useField2 = useField(computed(function () {\n      return name.value + '-s';\n    }), '' // { standalone: true }\n    ),\n        current = _useField2.value,\n        selectChange = _useField2.handleChange;\n\n    var opts = computed(function () {\n      return options.value.map(function (opt) {\n        return _objectSpread(_objectSpread({}, props.option(opt)), {}, {\n          meta: opt\n        });\n      });\n    });\n    var upload = throttle( /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee2() {\n      var loader;\n      return regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              if (!(value.value === '')) {\n                _context2.next = 2;\n                break;\n              }\n\n              return _context2.abrupt(\"return\");\n\n            case 2:\n              _context2.prev = 2;\n              loading.value = true;\n\n              loader = /*#__PURE__*/function () {\n                var _ref2 = _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee() {\n                  return regeneratorRuntime.wrap(function _callee$(_context) {\n                    while (1) {\n                      switch (_context.prev = _context.next) {\n                        case 0:\n                          return _context.abrupt(\"return\", props.fetcher(value.value));\n\n                        case 1:\n                        case \"end\":\n                          return _context.stop();\n                      }\n                    }\n                  }, _callee);\n                }));\n\n                return function loader() {\n                  return _ref2.apply(this, arguments);\n                };\n              }();\n\n              _context2.next = 7;\n              return loader();\n\n            case 7:\n              options.value = _context2.sent;\n              _context2.next = 14;\n              break;\n\n            case 10:\n              _context2.prev = 10;\n              _context2.t0 = _context2[\"catch\"](2);\n              console.error(_context2.t0);\n              alert('Произошла ошибка при загрузке данных!');\n\n            case 14:\n              _context2.prev = 14;\n              loading.value = false;\n              return _context2.finish(14);\n\n            case 17:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2, null, [[2, 10, 14, 17]]);\n    })), 800);\n    return {\n      current: current,\n      opts: opts,\n      loading: loading,\n      value: value,\n      handleChange: handleChange,\n      selectChange: selectChange,\n      showing: showing,\n      onClick: function onClick(opt) {\n        handleChange(opt.value);\n        selectChange(opt.meta);\n        showing.value = false;\n      },\n      onInput: function onInput(e) {\n        loading.value = true;\n        handleChange(e);\n        upload();\n      }\n    };\n  }\n};","map":{"version":3,"mappings":"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","names":["Field","useField","ref","toRefs","computed","throttle","inheritAttrs","props","fetcher","required","type","Function","option","default","setup","showing","options","loading","label","rules","name","validateOnValueUpdate","value","handleChange","current","selectChange","opts","map","opt","meta","upload","loader","console","error","alert","onClick","onInput","e"],"sourceRoot":"","sources":["C:\\projects\\gazprom\\formApplication\\src\\core\\AppFilterSelect.vue"],"sourcesContent":["<template>\n  <div class=\"tw-relative\">\n    <AppLabel v-bind=\"{ label, for: name }\" />\n    <input\n      v-bind=\"$attrs\"\n      autocomplete=\"off\"\n      class=\"app-input\"\n      :id=\"name\"\n      type=\"text\"\n      @focus=\"showing = true\"\n      @blur=\"showing = false\"\n      :value=\"value\"\n      @input=\"onInput\"\n    />\n    <AppErrorMessage v-bind=\"{ name }\" />\n    <div\n      v-if=\"showing\"\n      class=\"\n        tw-absolute\n        tw-w-full\n        tw-z-10\n        tw-border-b\n        tw-border-x\n        tw-border-gray-300\n        tw-rounded-b-lg\n        tw-max-h-44\n        tw-overflow-scroll\n      \"\n    >\n      <div class=\"tw-p-2 tw-bg-white\" v-if=\"value === ''\">\n        Начните вводить текст\n      </div>\n      <div\n        v-else-if=\"loading\"\n        class=\"tw-p-2 tw-bg-white hover:tw-bg-slate-300 tw-cursor-pointer\"\n      >\n        loading...\n      </div>\n      <template v-else>\n        <div class=\"tw-bg-white tw-p-2\" v-if=\"opts.length <= 0\">\n          Ничего не найдено\n        </div>\n        <div\n          v-for=\"(opt, i) in opts\"\n          :key=\"i\"\n          @click=\"onClick(opt)\"\n          class=\"tw-p-2 tw-bg-white hover:tw-bg-slate-300 tw-cursor-pointer\"\n        >\n          {{ opt.label }}\n        </div>\n      </template>\n    </div>\n  </div>\n</template>\n<script>\nimport { Field, useField } from 'vee-validate';\nimport { ref, toRefs, computed } from 'vue';\nimport { throttle } from '@/utilities/perfomance';\n\nexport default {\n  inheritAttrs: false,\n  props: {\n    ...Field.props,\n    fetcher: {\n      required: true,\n      type: Function,\n    },\n    option: {\n      default() {\n        return (option) => option;\n      },\n      type: Function,\n    },\n  },\n  setup(props) {\n    const showing = ref(false);\n    const options = ref([]);\n    const loading = ref(false);\n    const { label, rules, name } = toRefs(props);\n    const { value, handleChange } = useField(name, rules, {\n      validateOnValueUpdate: false,\n      label,\n    });\n\n    const { value: current, handleChange: selectChange } = useField(\n      computed(() => name.value + '-s'),\n      '',\n      // { standalone: true }\n    );\n\n    const opts = computed(() => {\n      return options.value.map((opt) => ({ ...props.option(opt), meta: opt }));\n    });\n\n    const upload = throttle(async () => {\n      if (value.value === '') return;\n\n      try {\n        loading.value = true;\n        const loader = async () => props.fetcher(value.value);\n        options.value = await loader();\n      } catch (err) {\n        console.error(err);\n        alert('Произошла ошибка при загрузке данных!');\n      } finally {\n        loading.value = false;\n      }\n    }, 800);\n\n    return {\n      current,\n      opts,\n      loading,\n      value,\n      handleChange,\n      selectChange,\n      showing,\n      onClick(opt) {\n        handleChange(opt.value);\n        selectChange(opt.meta);\n        showing.value = false;\n      },\n      onInput(e) {\n        loading.value = true;\n        handleChange(e);\n        upload();\n      },\n    };\n  },\n};\n</script>\n\n<style scoped>\n.app-input {\n  @apply tw-border tw-border-gray-400 tw-rounded-lg tw-h-8 tw-px-2 tw-block tw-w-full;\n}\n\n.app-input:hover,\n.app-input:focus {\n  @apply tw-border-primary;\n}\n</style>\n"]},"metadata":{},"sourceType":"module"}